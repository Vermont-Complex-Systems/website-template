/* =============================================================================
   VCSI LAYOUTS
   Layout patterns for scrollytelling stories.
   ============================================================================= */

/* =============================================================================
   LIGHT STORY THEME (default)
   Stories default to light mode, independent of global dark mode toggle.
   Customize with: style="--vcsi-story-bg: #fff; --vcsi-story-fg: #333;"
   ============================================================================= */

.story {
  color-scheme: light;
  /* Isolate from global dark mode - force light semantic tokens */
  --vcsi-bg: var(--vcsi-bg-light);
  --vcsi-fg: var(--vcsi-fg-light);
  --vcsi-hover: var(--vcsi-hover-light);
  --vcsi-border: var(--vcsi-border-light);

  /* Story-specific tokens */
  --vcsi-story-bg: var(--vcsi-color-beige, #f4efea);
  --vcsi-story-fg: rgb(55, 55, 55);
  --vcsi-story-max-width: 600px;

  /* ScrollyContent step colors (component reads these with fallbacks) */
  --story-step-bg: #fff;
  --story-step-fg: #333;
  --story-step-bg-inactive: #f5f5f5;
  --story-step-fg-inactive: #ccc;
}

/* =============================================================================
   LAYOUT: STORY
   Full-width container for scrollytelling stories.
   ============================================================================= */

.story {
  width: 100%;
  padding-top: 5.5rem;
  padding-bottom: 7.5rem;
  background: var(--vcsi-story-bg);
  color: var(--vcsi-story-fg);
}

@media (max-width: 768px) {
  .story {
    padding-top: 6rem; /* Clear the BackToHome logo */
  }
}

/* =============================================================================
   STORY PROSE (default for content)
   Direct children get centered, readable width by default.
   Layout classes break out to full width.
   ============================================================================= */

.story > h1,
.story > h2,
.story > h3,
.story > p,
.story > section,
.story > header,
.story > ul,
.story > ol,
.story > blockquote,
.story > pre {
  width: 100%;
  max-width: var(--vcsi-story-max-width);
  margin-inline: auto;
  padding-inline: var(--vcsi-space-md);
}


/* Layout classes break out to full width */
.story > .split-layout,
.story > .fullscreen-layout,
.story > .triple-layout,
.story > .scrolly-section {
  max-width: none;
  padding-inline: 0;
}


/* =============================================================================
   DARK STORY THEME
   Add data-theme="dark" for stories with dark backgrounds.
   Customize with: style="--vcsi-story-bg: #353839; --vcsi-story-fg: white;"
   ============================================================================= */

.story[data-theme="dark"] {
  color-scheme: dark;
  --vcsi-story-bg: #353839;
  --vcsi-story-fg: white;

  /* ScrollyContent step colors for dark theme */
  --story-step-bg: #2a2a2a;
  --story-step-fg: #e8e8e8;
  --story-step-bg-inactive: #222;
  --story-step-fg-inactive: #666;
}

/* Ensure all text in dark stories uses the story foreground color */
.story[data-theme="dark"],
.story[data-theme="dark"] h1,
.story[data-theme="dark"] h2,
.story[data-theme="dark"] h3,
.story[data-theme="dark"] p,
.story[data-theme="dark"] a,
.story[data-theme="dark"] section {
  color: var(--vcsi-story-fg);
}


/* =============================================================================
   LAYOUT: SPLIT (Two-Column)
   Generic side-by-side layout with one sticky panel and one scrolling content area.
   Default: content on left, sticky panel on right. Add .reversed to flip.

   Usage:
     <section class="split-layout">
       <div class="sticky-panel">...</div>
       <div class="scrolly-content">...</div>
     </section>

     <!-- Reversed: panel on left, content on right -->
     <section class="split-layout reversed">
       ...
     </section>
   ============================================================================= */

.split-layout {
  /* Panel configuration (specific to two-column layout) */
  --vcsi-panel-min-width: 450px;
  --vcsi-panel-width: 45%;
  --vcsi-panel-height: min(80vh, 600px); /* Capped so top-offset calc stays accurate */
  --vcsi-panel-top-offset: calc((100vh - var(--vcsi-panel-height)) / 2); /* auto-center vertically */
  --vcsi-layout-gap: 2rem;

  position: relative;
  display: grid;
  grid-template-columns: 1fr minmax(var(--vcsi-panel-min-width), var(--vcsi-panel-width));
  gap: var(--vcsi-layout-gap);
  align-items: start;
  padding-inline: var(--vcsi-content-padding-inline, 2rem);

  /* Override shared defaults for this layout */
  --vcsi-content-max-width: none;
}

/* Reversed: panel on left, content on right */
.split-layout.reversed {
  grid-template-columns: minmax(var(--vcsi-panel-min-width), var(--vcsi-panel-width)) 1fr;
}

.split-layout .sticky-panel {
  position: sticky;
  top: var(--vcsi-panel-top-offset);
  height: var(--vcsi-panel-height);
  grid-column: 2;
  display: flex;
  align-items: center;
  justify-content: center;
}

.split-layout.reversed .sticky-panel {
  grid-column: 1;
}

.split-layout .scrolly-content {
  grid-column: 1;
  margin: 0;
}

.split-layout.reversed .scrolly-content {
  grid-column: 2;
}

@media (max-width: 768px) {
  .split-layout {
    grid-template-columns: 1fr;
    padding-inline: 0;
    --vcsi-step-max-width: 100%;
    max-width: 100vw;
    overflow-x: clip; /* clip instead of hidden to preserve sticky */
  }

  .split-layout .sticky-panel {
    position: sticky;
    top: 0;
    height: 100vh;
    grid-column: 1;
    grid-row: 1;
    width: 100%;
    min-width: 0; /* Allow shrinking below content size */
    z-index: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* On mobile, both occupy same grid cell for natural overlap.
     Safari mobile needs physical overlap for z-index to work during client-side nav */
  .split-layout .scrolly-content,
  .split-layout .scrolly-outer {
    grid-column: 1;
    grid-row: 1;
    z-index: 1;
    pointer-events: none;
    padding-inline: var(--vcsi-content-padding-inline, 2rem);
  }

  /* Reversed has no effect on mobile (stacks vertically) */
  .split-layout.reversed .sticky-panel,
  .split-layout.reversed .scrolly-content {
    grid-column: 1;
  }
}


/* =============================================================================
   LAYOUT: FULLSCREEN
   Full-viewport background with centered text overlay.
   Use for immersive, full-bleed visualizations.

   Usage:
     <section class="fullscreen-layout">
       <div class="sticky-panel">...</div>
       <div class="scrolly-content">...</div>
     </section>
   ============================================================================= */

.fullscreen-layout {
  position: relative;
  width: 100vw;
  margin-left: calc(-50vw + 50%);

  /* Override shared defaults for immersive fullscreen experience */
  --vcsi-step-max-width: 500px;
  --vcsi-step-padding: 2rem;
  --vcsi-step-pointer-events: none; /* Let events pass to panel behind */
}

.fullscreen-layout .sticky-panel {
  position: sticky;
  top: 0;
  width: 100vw;
  height: 100vh;
  z-index: 0;
}

.fullscreen-layout .scrolly-content {
  position: relative;
  z-index: 1;
  margin: 0 auto;
}


/* =============================================================================
   LAYOUT: TRIPLE (Three-Column)
   Three equal columns: content (steps), code panel, and visualization.
   All three panels share equal width with the code and chart panels sticky.

   Usage:
     <section class="triple-layout">
       <div class="scrolly-content">...</div>
       <div class="code-panel">...</div>
       <div class="chart-panel">...</div>
     </section>
   ============================================================================= */

.triple-layout {
  --vcsi-panel-height: min(95vh, 900px);
  --vcsi-panel-top-offset: calc((100vh - var(--vcsi-panel-height)) / 2);
  --vcsi-layout-gap: 1.5rem;

  position: relative;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: var(--vcsi-layout-gap);
  align-items: start;
  padding-inline: var(--vcsi-content-padding-inline, 2rem);
}

.triple-layout .scrolly-content {
  grid-column: 1;
}

.triple-layout .code-panel {
  position: sticky;
  top: var(--vcsi-panel-top-offset);
  height: var(--vcsi-panel-height);
  grid-column: 2;
}

.triple-layout .chart-panel {
  position: sticky;
  top: var(--vcsi-panel-top-offset);
  height: var(--vcsi-panel-height);
  grid-column: 3;
}

@media (max-width: 1024px) {
  .triple-layout {
    grid-template-columns: 1fr 1fr;
  }

  .triple-layout .chart-panel {
    grid-column: 2;
    grid-row: 1;
  }

  .triple-layout .code-panel {
    display: none; /* Hide code on tablet, show only steps and chart */
  }
}

@media (max-width: 768px) {
  .triple-layout {
    grid-template-columns: 1fr;
  }

  .triple-layout .chart-panel {
    position: sticky;
    top: 0;
    height: 100vh;
    max-height: none;
    grid-column: 1;
    grid-row: 1;
    z-index: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .triple-layout .scrolly-content {
    grid-column: 1;
    grid-row: 1;
    z-index: 1;
    pointer-events: none;
    padding-inline: var(--vcsi-content-padding-inline, 2rem);
  }
}


/* =============================================================================
   LAYOUT: DASHBOARD
   Grid layout with collapsible sidebar and main content area.
   Sidebar resizes on collapse, main content expands to fill space.

   Usage:
     <article class="dashboard-layout">
       <aside class="dashboard-sidebar">...</aside>
       <main class="dashboard-main">...</main>
     </article>
   ============================================================================= */

.dashboard-layout {
  --vcsi-sidebar-width: 280px;
  --vcsi-sidebar-collapsed-width: 48px;
  --vcsi-sidebar-transition: var(--vcsi-transition-slow);
  --vcsi-sidebar-bg: #ebe6e1;
  --vcsi-z-overlay: 1000;

  display: grid;
  grid-template-columns: var(--vcsi-sidebar-width) 1fr;
  height: 100vh;
  width: 100%;
  transition: grid-template-columns var(--vcsi-sidebar-transition);
}

.dashboard-layout.sidebar-collapsed {
  grid-template-columns: var(--vcsi-sidebar-collapsed-width) 1fr;
}

.dashboard-sidebar {
  position: relative;
  background: var(--vcsi-sidebar-bg);
  border-right: 1px solid var(--vcsi-border);
  overflow: hidden;
  transition: width var(--vcsi-sidebar-transition);
}

.dashboard-layout .sidebar-toggle {
  position: absolute;
  top: var(--vcsi-space-md);
  left: calc(var(--vcsi-sidebar-width) - 32px - var(--vcsi-space-md));
  width: 32px;
  height: 32px;
  padding: 0;
  border: 1px solid var(--vcsi-border);
  border-radius: 4px;
  background: var(--vcsi-color-white, #fff);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: left var(--vcsi-sidebar-transition), transform var(--vcsi-sidebar-transition);
  z-index: 10;
}

.dashboard-layout.sidebar-collapsed .sidebar-toggle {
  left: 8px;
  transform: rotate(180deg);
}

.dashboard-sidebar .sidebar-content {
  padding: 4rem var(--vcsi-space-lg) var(--vcsi-space-lg);
  opacity: 1;
  transition: opacity calc(var(--vcsi-sidebar-transition) / 2);
}

.dashboard-layout.sidebar-collapsed .sidebar-content {
  opacity: 0;
  pointer-events: none;
}

.dashboard-main {
  position: relative;
  overflow: hidden;
  padding: var(--vcsi-space-lg);
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Dashboard sidebar form elements */
.dashboard-sidebar h3 {
  font-family: var(--vcsi-font-sans, system-ui, sans-serif);
  font-size: var(--vcsi-font-size-small, 14px);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin: 0 0 var(--vcsi-space-lg);
  color: var(--vcsi-gray-700, rgb(78, 78, 78));
}

.dashboard-sidebar label {
  display: block;
  font-family: var(--vcsi-font-sans, system-ui, sans-serif);
  font-size: var(--vcsi-font-size-xs, 12px);
  font-weight: 500;
  margin-bottom: var(--vcsi-space-sm);
  color: var(--vcsi-gray-700, rgb(78, 78, 78));
}

.dashboard-sidebar select {
  width: 100%;
  padding: var(--vcsi-space-sm) 0.75rem;
  font-family: var(--vcsi-font-sans, system-ui, sans-serif);
  font-size: var(--vcsi-font-size-small, 14px);
  border: 1px solid var(--vcsi-border);
  border-radius: 4px;
  background: var(--vcsi-color-white, #fff);
  margin-bottom: var(--vcsi-space-lg);
}

.dashboard-sidebar fieldset {
  border: none;
  padding: 0;
  margin: 0 0 var(--vcsi-space-lg);
}

.dashboard-sidebar legend {
  font-family: var(--vcsi-font-sans, system-ui, sans-serif);
  font-size: var(--vcsi-font-size-xs, 12px);
  font-weight: 500;
  margin-bottom: 0.75rem;
  color: var(--vcsi-gray-700, rgb(78, 78, 78));
}

.dashboard-sidebar .checkbox-group {
  display: flex;
  flex-direction: column;
  gap: var(--vcsi-space-sm);
}

.dashboard-sidebar .checkbox-group label {
  display: flex;
  align-items: center;
  gap: var(--vcsi-space-sm);
  font-weight: 400;
  margin-bottom: 0;
  cursor: pointer;
}

.dashboard-sidebar .checkbox-group input[type="checkbox"] {
  width: 16px;
  height: 16px;
  accent-color: var(--vcsi-color-accent, #154734);
}

/* Dashboard mobile: slide-down drawer from top */
@media (max-width: 768px) {
  .dashboard-layout {
    display: block;
    position: relative;
  }

  .dashboard-sidebar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    max-height: 95vh;
    height: auto;
    z-index: var(--vcsi-z-overlay);
    transform: translateY(-100%);
    transition: transform var(--vcsi-sidebar-transition);
    border-right: none;
    border-bottom: 1px solid var(--vcsi-border);
    overflow-y: auto;
  }

  .dashboard-layout.sidebar-open .dashboard-sidebar {
    transform: translateY(0);
  }

  .dashboard-sidebar .sidebar-content {
    opacity: 1;
    pointer-events: auto;
    padding: var(--vcsi-space-md) var(--vcsi-space-lg) var(--vcsi-space-lg);
  }

  .dashboard-layout .sidebar-toggle {
    position: fixed;
    top: var(--vcsi-space-md);
    right: var(--vcsi-space-md);
    left: auto;
    width: 2.5rem;
    height: 2.5rem;
    border: none;
    border-radius: var(--vcsi-radius-md);
    background: transparent;
    color: var(--vcsi-gray-900, rgb(38, 38, 38));
    z-index: calc(var(--vcsi-z-overlay) + 1);
    transform: none;
  }

  .dashboard-layout .sidebar-toggle:hover {
    background: rgba(0, 0, 0, 0.05);
  }

  .dashboard-layout.sidebar-open .sidebar-toggle {
    top: var(--vcsi-space-md);
    right: var(--vcsi-space-md);
    left: auto;
    transform: none;
  }

  .dashboard-main {
    width: 100%;
    height: 100vh;
    padding: 0;
  }

  .dashboard-backdrop {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: calc(var(--vcsi-z-overlay) - 1);
  }

  .dashboard-layout.sidebar-open .dashboard-backdrop {
    display: block;
  }
}

@media (min-width: 769px) {
  .dashboard-backdrop {
    display: none;
  }
}


/* =============================================================================
   LAYOUT: PAGE
   Centered container for app pages (Home, About, etc).
   Provides consistent max-width and padding for non-story content.

   Usage:
     <article class="page">
       <h1>Page Title</h1>
       <p>Content...</p>
     </article>
   ============================================================================= */

.page {
  width: 100%;
  max-width: var(--vcsi-page-max-width, 1200px);
  margin-inline: auto;
  padding-inline: var(--vcsi-page-inline-padding, 5%);
  padding-top: 5.5rem;
  padding-bottom: 7.5rem;
}

@media (max-width: 768px) {
  .page {
    padding-bottom: var(--vcsi-space-2xl, 3rem);
  }
}
